<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Author Dashboard - Babcock University Publishing</title>

    <!-- Fonts & Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      :root {
        --primary-color: #006747;
        --primary-dark: #005035;
        --primary-light: #007c59;
        --secondary-color: #ffd700;
        --accent-color: #8b0000;
        --success-color: #28a745;
        --warning-color: #ffc107;
        --danger-color: #dc3545;
        --info-color: #17a2b8;
        --light-color: #f8f9fa;
        --dark-color: #343a40;
        --gray-100: #f8f9fa;
        --gray-200: #e9ecef;
        --gray-300: #dee2e6;
        --gray-400: #ced4da;
        --gray-500: #adb5bd;
        --gray-600: #6c757d;
        --gray-700: #495057;
        --gray-800: #343a40;
        --gray-900: #212529;

        --sidebar-width: 260px;
        --header-height: 70px;
        --border-radius: 8px;
        --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: var(--gray-100);
        color: var(--gray-800);
        line-height: 1.6;
      }

      /* Login Page */
      .login-page {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--primary-dark) 100%
        );
        padding: 20px;
      }

      .login-container {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        width: 100%;
        max-width: 420px;
        overflow: hidden;
      }

      .login-header {
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--primary-dark) 100%
        );
        color: white;
        padding: 40px 30px;
        text-align: center;
      }

      .login-header .logo {
        width: 80px;
        height: 80px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
      }

      .login-header .logo img {
        width: 60px;
        height: 60px;
      }

      .login-header h1 {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .login-header p {
        opacity: 0.9;
        font-size: 14px;
      }

      .login-form {
        padding: 40px 30px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--gray-700);
        font-size: 14px;
      }

      .form-control {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid var(--gray-300);
        border-radius: 6px;
        font-size: 14px;
        font-family: "Inter", sans-serif;
        transition: var(--transition);
      }

      .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(0, 103, 71, 0.1);
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .btn-primary {
        background: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 103, 71, 0.3);
      }

      .btn-block {
        width: 100%;
      }

      /* Dashboard */
      .dashboard-container {
        display: none;
        min-height: 100vh;
      }

      /* Header */
      .dashboard-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: var(--header-height);
        background: white;
        box-shadow: var(--box-shadow);
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 30px;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .brand-logo {
        width: 40px;
        height: 40px;
      }

      .brand-text h2 {
        font-size: 18px;
        font-weight: 700;
        color: var(--primary-color);
      }

      .brand-text p {
        font-size: 12px;
        color: var(--gray-600);
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .user-menu {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        transition: var(--transition);
      }

      .user-menu:hover {
        background: var(--gray-200);
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--primary-dark) 100%
        );
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
      }

      .user-info {
        display: flex;
        flex-direction: column;
      }

      .user-info span:first-child {
        font-weight: 600;
        font-size: 14px;
      }

      .user-info span:last-child {
        font-size: 12px;
        color: var(--gray-600);
      }

      /* Main Content */
      .dashboard-main {
        margin-top: var(--header-height);
        padding: 30px;
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      }

      .page-header h1 {
        font-size: 24px;
        font-weight: 700;
        color: var(--gray-800);
      }

      /* Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        border-radius: var(--border-radius);
        padding: 24px;
        box-shadow: var(--box-shadow);
        display: flex;
        align-items: center;
        gap: 20px;
        transition: var(--transition);
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
      }

      .stat-content {
        flex: 1;
      }

      .stat-content h3 {
        font-size: 28px;
        font-weight: 700;
        color: var(--gray-800);
        margin-bottom: 5px;
      }

      .stat-content p {
        font-size: 14px;
        color: var(--gray-600);
        margin-bottom: 8px;
      }

      /* Books Grid */
      .books-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .book-card {
        background: white;
        border-radius: var(--border-radius);
        padding: 20px;
        box-shadow: var(--box-shadow);
        transition: var(--transition);
      }

      .book-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      .book-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
      }

      .book-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 5px;
      }

      .book-status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .status-draft {
        background: #e2e3e5;
        color: #383d41;
      }
      .status-submitted {
        background: #d1ecf1;
        color: #0c5460;
      }
      .status-under_review {
        background: #fff3cd;
        color: #856404;
      }
      .status-accepted {
        background: #d4edda;
        color: #155724;
      }
      .status-in_production {
        background: #cce5ff;
        color: #004085;
      }
      .status-published {
        background: #d4edda;
        color: #155724;
      }

      .progress-container {
        margin: 20px 0;
      }

      .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        font-size: 14px;
        color: var(--gray-600);
      }

      .progress-bar {
        height: 8px;
        background: var(--gray-200);
        border-radius: 4px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--primary-light)
        );
        border-radius: 4px;
        transition: width 0.5s ease;
      }

      .book-meta {
        display: flex;
        gap: 15px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid var(--gray-200);
        font-size: 13px;
        color: var(--gray-600);
      }

      .book-meta span {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .book-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .btn-sm {
        padding: 8px 16px;
        font-size: 13px;
      }

      .btn-outline {
        background: transparent;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
      }

      .btn-outline:hover {
        background: var(--primary-color);
        color: white;
      }

      /* Reviews Section */
      .reviews-container {
        background: white;
        border-radius: var(--border-radius);
        padding: 24px;
        box-shadow: var(--box-shadow);
        margin-top: 30px;
      }

      .review-item {
        padding: 15px;
        border-bottom: 1px solid var(--gray-200);
        display: flex;
        gap: 15px;
      }

      .review-item:last-child {
        border-bottom: none;
      }

      .reviewer-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--primary-dark) 100%
        );
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        flex-shrink: 0;
      }

      .review-content {
        flex: 1;
      }

      .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
      }

      .reviewer-name {
        font-weight: 600;
        color: var(--gray-800);
      }

      .review-date {
        font-size: 12px;
        color: var(--gray-500);
      }

      .review-rating {
        color: #ffc107;
        font-size: 14px;
        margin-bottom: 10px;
      }

      /* Royalties Section */
      .royalties-container {
        background: white;
        border-radius: var(--border-radius);
        padding: 24px;
        box-shadow: var(--box-shadow);
        margin-top: 30px;
      }

      .royalty-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .royalty-item {
        text-align: center;
        padding: 20px;
        background: var(--gray-100);
        border-radius: var(--border-radius);
      }

      .royalty-amount {
        font-size: 28px;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 5px;
      }

      .royalty-label {
        font-size: 14px;
        color: var(--gray-600);
      }

      /* Loading Spinner */
      .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(0, 103, 71, 0.3);
        border-radius: 50%;
        border-top-color: var(--primary-color);
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: var(--border-radius);
        max-width: 800px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        padding: 24px;
        border-bottom: 1px solid var(--gray-200);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-header h3 {
        font-size: 20px;
        font-weight: 600;
        color: var(--gray-800);
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: var(--gray-600);
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: var(--transition);
      }

      .modal-close:hover {
        background: var(--gray-200);
        color: var(--danger-color);
      }

      .modal-body {
        padding: 24px;
      }

      /* Progress Timeline */
      .progress-timeline {
        position: relative;
        padding: 20px 0;
      }

      .progress-timeline::before {
        content: "";
        position: absolute;
        left: 20px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: var(--gray-300);
      }

      .timeline-item {
        position: relative;
        padding-left: 50px;
        margin-bottom: 20px;
      }

      .timeline-item:last-child {
        margin-bottom: 0;
      }

      .timeline-dot {
        position: absolute;
        left: 15px;
        top: 0;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--gray-400);
        z-index: 1;
      }

      .timeline-item.completed .timeline-dot {
        background: var(--success-color);
      }

      .timeline-item.in-progress .timeline-dot {
        background: var(--primary-color);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(0, 103, 71, 0.4);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(0, 103, 71, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(0, 103, 71, 0);
        }
      }

      .timeline-content {
        background: var(--gray-100);
        padding: 15px;
        border-radius: var(--border-radius);
      }

      .timeline-title {
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--gray-800);
      }

      .timeline-date {
        font-size: 12px;
        color: var(--gray-600);
        margin-bottom: 10px;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .dashboard-main {
          padding: 20px;
        }

        .page-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 15px;
        }

        .books-grid {
          grid-template-columns: 1fr;
        }

        .royalty-summary {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Login Page -->
    <div class="login-page" id="loginPage">
      <div class="login-container">
        <div class="login-header">
          <div class="logo">
            <img src="./OIP.webp" alt="Babcock University" />
          </div>
          <h1>Author Dashboard</h1>
          <p>Track your publications and progress</p>
        </div>
        <form class="login-form" id="authorLoginForm">
          <div class="form-group">
            <label for="loginEmail">Email Address</label>
            <input
              type="email"
              id="loginEmail"
              class="form-control"
              placeholder="author@babcock.edu.ng"
              required />
          </div>
          <div class="form-group">
            <label for="loginPassword">Password</label>
            <input
              type="password"
              id="loginPassword"
              class="form-control"
              placeholder="Enter password"
              required />
          </div>
          <button type="submit" class="btn btn-primary btn-block">
            <i class="fas fa-sign-in-alt"></i> Login
          </button>
          <div style="text-align: center; margin-top: 20px">
            <a
              href="index.html"
              style="color: var(--primary-color); text-decoration: none">
              <i class="fas fa-home"></i> Back to Home
            </a>
          </div>
        </form>
      </div>
    </div>

    <!-- Author Dashboard -->
    <div class="dashboard-container" id="dashboardContainer">
      <!-- Header -->
      <header class="dashboard-header">
        <div class="header-left">
          <div class="brand">
            <img src="./OIP.webp" alt="Logo" class="brand-logo" />
            <div class="brand-text">
              <h2>Author Dashboard</h2>
              <p>Babcock University Publishing</p>
            </div>
          </div>
        </div>
        <div class="header-right">
          <div class="user-menu" id="userMenu">
            <div class="user-avatar" id="userAvatar">A</div>
            <div class="user-info">
              <span id="userName">Author Name</span>
              <span id="userRole">Author</span>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="dashboard-main" id="dashboardMain">
        <div class="page-header">
          <h1>My Publications Dashboard</h1>
          <button class="btn btn-primary" onclick="showNewBookModal()">
            <i class="fas fa-plus"></i> New Book
          </button>
        </div>

        <!-- Statistics -->
        <div class="stats-grid" id="statsGrid">
          <div class="stat-card">
            <div
              class="stat-icon"
              style="
                background: linear-gradient(135deg, #006747 0%, #005035 100%);
              ">
              <i class="fas fa-book"></i>
            </div>
            <div class="stat-content">
              <h3 id="totalBooks">0</h3>
              <p>Total Books</p>
              <div class="stat-trend" id="booksTrend"></div>
            </div>
          </div>

          <div class="stat-card">
            <div
              class="stat-icon"
              style="
                background: linear-gradient(135deg, #28a745 0%, #218838 100%);
              ">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
              <h3 id="publishedBooks">0</h3>
              <p>Published</p>
              <div class="stat-trend" id="publishedTrend"></div>
            </div>
          </div>

          <div class="stat-card">
            <div
              class="stat-icon"
              style="
                background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
              ">
              <i class="fas fa-hourglass-half"></i>
            </div>
            <div class="stat-content">
              <h3 id="inProgressBooks">0</h3>
              <p>In Progress</p>
              <div class="stat-trend" id="progressTrend"></div>
            </div>
          </div>

          <div class="stat-card">
            <div
              class="stat-icon"
              style="
                background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
              ">
              <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="stat-content">
              <h3 id="totalRoyalties">₦0</h3>
              <p>Total Royalties</p>
              <div class="stat-trend" id="royaltiesTrend"></div>
            </div>
          </div>
        </div>

        <!-- Books Section -->
        <div class="books-section">
          <h2 style="margin-bottom: 20px; color: var(--gray-800)">My Books</h2>
          <div class="books-grid" id="booksGrid">
            <!-- Books will be loaded here -->
          </div>
        </div>

        <!-- Royalties Summary -->
        <div class="royalties-container">
          <h2 style="margin-bottom: 20px; color: var(--gray-800)">
            Royalties Summary
          </h2>
          <div class="royalty-summary" id="royaltySummary">
            <!-- Royalty data will be loaded here -->
          </div>
        </div>

        <!-- Recent Reviews -->
        <div class="reviews-container">
          <h2 style="margin-bottom: 20px; color: var(--gray-800)">
            Recent Reviews
          </h2>
          <div id="reviewsList">
            <!-- Reviews will be loaded here -->
          </div>
        </div>
      </main>
    </div>

    <!-- Book Details Modal -->
    <div class="modal" id="bookDetailsModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalBookTitle">Book Details</h3>
          <button class="modal-close" onclick="closeModal('bookDetailsModal')">
            &times;
          </button>
        </div>
        <div class="modal-body" id="bookDetailsContent">
          <!-- Book details will be loaded here -->
        </div>
      </div>
    </div>

    <!-- New Book Modal -->
    <div class="modal" id="newBookModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Submit New Book</h3>
          <button class="modal-close" onclick="closeModal('newBookModal')">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="newBookForm">
            <div class="form-group">
              <label for="bookTitle">Book Title *</label>
              <input type="text" id="bookTitle" class="form-control" required />
            </div>
            <div class="form-group">
              <label for="bookSubtitle">Subtitle</label>
              <input type="text" id="bookSubtitle" class="form-control" />
            </div>
            <div class="form-group">
              <label for="bookCategory">Category *</label>
              <select id="bookCategory" class="form-control" required>
                <option value="">Select Category</option>
                <option value="academic">Academic</option>
                <option value="textbook">Textbook</option>
                <option value="research">Research</option>
                <option value="fiction">Fiction</option>
                <option value="non-fiction">Non-Fiction</option>
              </select>
            </div>
            <div class="form-group">
              <label for="bookDescription">Description *</label>
              <textarea
                id="bookDescription"
                class="form-control"
                rows="4"
                required></textarea>
            </div>
            <div class="form-group">
              <label for="bookKeywords">Keywords (comma separated)</label>
              <input
                type="text"
                id="bookKeywords"
                class="form-control"
                placeholder="keyword1, keyword2, keyword3" />
            </div>
            <div class="form-group">
              <label for="bookFormat">Format *</label>
              <select id="bookFormat" class="form-control" required>
                <option value="paperback">Paperback</option>
                <option value="hardcover">Hardcover</option>
                <option value="ebook">E-book</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary btn-block">
              Submit Book
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Loading Modal -->
    <div class="modal" id="loadingModal">
      <div class="modal-content" style="max-width: 300px; text-align: center">
        <div class="modal-body">
          <div
            class="spinner"
            style="width: 40px; height: 40px; margin: 20px auto"></div>
          <p id="loadingText">Loading...</p>
        </div>
      </div>
    </div>

    <script>
      // Global variables
      const API_BASE_URL = "http://localhost:3001/api";
      let currentAuthor = null;
      let authToken = localStorage.getItem("authToken");

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        if (authToken) {
          verifyToken();
        }

        // Setup event listeners
        document
          .getElementById("authorLoginForm")
          .addEventListener("submit", loginAuthor);
      });

      // Verify token
      async function verifyToken() {
        try {
          const response = await fetch(`${API_BASE_URL}/auth/verify`, {
            headers: {
              Authorization: `Bearer ${authToken}`,
            },
          });

          const data = await response.json();

          if (data.success) {
            currentAuthor = data.user;
            showDashboard();
            loadAuthorDashboard();
          } else {
            localStorage.removeItem("authToken");
            showLogin();
          }
        } catch (error) {
          localStorage.removeItem("authToken");
          showLogin();
        }
      }

      // Author login
      async function loginAuthor(e) {
        e.preventDefault();

        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        showLoading("Logging in...");

        try {
          const response = await fetch(`${API_BASE_URL}/users/login`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ email, password }),
          });

          const data = await response.json();

          if (data.success && data.user.role === "author") {
            authToken = data.token;
            localStorage.setItem("authToken", authToken);
            currentAuthor = data.user;
            showDashboard();
            loadAuthorDashboard();
          } else {
            throw new Error("Invalid credentials or not an author account");
          }
        } catch (error) {
          alert("Login failed: " + error.message);
        } finally {
          hideLoading();
        }
      }

      // Show dashboard
      function showDashboard() {
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("dashboardContainer").style.display = "block";

        // Update user info
        document.getElementById("userName").textContent =
          currentAuthor.full_name;
        document.getElementById("userAvatar").textContent =
          currentAuthor.full_name.charAt(0).toUpperCase();
      }

      // Show login
      function showLogin() {
        document.getElementById("loginPage").style.display = "flex";
        document.getElementById("dashboardContainer").style.display = "none";
      }

      // Load author dashboard
      async function loadAuthorDashboard() {
        showLoading("Loading dashboard...");

        try {
          const response = await fetch(`${API_BASE_URL}/author/dashboard`, {
            headers: {
              Authorization: `Bearer ${authToken}`,
            },
          });

          const data = await response.json();

          if (data.success) {
            updateDashboard(data.data);
          }
        } catch (error) {
          console.error("Failed to load dashboard:", error);
        } finally {
          hideLoading();
        }
      }

      // Update dashboard with data
      function updateDashboard(data) {
        // Update stats
        document.getElementById("totalBooks").textContent =
          data.stats.total_books || 0;
        document.getElementById("publishedBooks").textContent =
          data.stats.published_books || 0;
        document.getElementById("inProgressBooks").textContent =
          (data.stats.in_production_books || 0) +
          (data.stats.under_review_books || 0);
        document.getElementById("totalRoyalties").textContent = formatCurrency(
          data.royalties.total_royalties || 0,
        );

        // Update books grid
        updateBooksGrid(data.books);

        // Update royalties summary
        updateRoyaltiesSummary(data.royalties);

        // Update reviews
        updateReviews(data.recentReviews);
      }

      // Update books grid
      function updateBooksGrid(books) {
        const booksGrid = document.getElementById("booksGrid");
        booksGrid.innerHTML = "";

        if (books.length === 0) {
          booksGrid.innerHTML =
            '<p style="grid-column: 1/-1; text-align: center; color: var(--gray-600);">No books found. Submit your first book!</p>';
          return;
        }

        books.forEach((book) => {
          const progress = calculateBookProgress(book);

          const bookCard = document.createElement("div");
          bookCard.className = "book-card";
          bookCard.innerHTML = `
                    <div class="book-header">
                        <div>
                            <h3 class="book-title">${book.title}</h3>
                            <p style="color: var(--gray-600); font-size: 14px;">ISBN: ${book.isbn || "Pending"}</p>
                        </div>
                        <span class="book-status status-${book.status}">${book.status.replace("_", " ")}</span>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Progress</span>
                            <span>${progress}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                    </div>
                    
                    <div class="book-meta">
                        <span><i class="far fa-calendar"></i> ${new Date(book.created_at).toLocaleDateString()}</span>
                        <span><i class="fas fa-book-open"></i> ${book.page_count || "N/A"} pages</span>
                        <span><i class="fas fa-comments"></i> ${book.review_count || 0} reviews</span>
                    </div>
                    
                    <div class="book-actions">
                        <button class="btn btn-outline btn-sm" onclick="viewBookDetails(${book.id})">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                        ${
                          book.status === "draft"
                            ? `
                            <button class="btn btn-primary btn-sm" onclick="submitBookForReview(${book.id})">
                                <i class="fas fa-paper-plane"></i> Submit for Review
                            </button>
                        `
                            : ""
                        }
                    </div>
                `;

          booksGrid.appendChild(bookCard);
        });
      }

      // Calculate book progress
      function calculateBookProgress(book) {
        const statusProgress = {
          draft: 10,
          submitted: 20,
          under_review: 40,
          revisions_requested: 60,
          accepted: 80,
          in_production: 90,
          published: 100,
          rejected: 0,
          archived: 0,
        };

        return statusProgress[book.status] || 0;
      }

      // Update royalties summary
      function updateRoyaltiesSummary(royalties) {
        const summaryContainer = document.getElementById("royaltySummary");
        summaryContainer.innerHTML = `
                <div class="royalty-item">
                    <div class="royalty-amount">${formatCurrency(royalties.total_royalties || 0)}</div>
                    <div class="royalty-label">Total Royalties</div>
                </div>
                <div class="royalty-item">
                    <div class="royalty-amount">${formatCurrency(royalties.paid_royalties || 0)}</div>
                    <div class="royalty-label">Paid Royalties</div>
                </div>
                <div class="royalty-item">
                    <div class="royalty-amount">${formatCurrency(royalties.pending_royalties || 0)}</div>
                    <div class="royalty-label">Pending Royalties</div>
                </div>
            `;
      }

      // Update reviews
      function updateReviews(reviews) {
        const reviewsList = document.getElementById("reviewsList");

        if (!reviews || reviews.length === 0) {
          reviewsList.innerHTML =
            '<p style="color: var(--gray-600); text-align: center;">No reviews yet</p>';
          return;
        }

        reviewsList.innerHTML = reviews
          .map(
            (review) => `
                <div class="review-item">
                    <div class="reviewer-avatar">${review.reviewer_name ? review.reviewer_name.charAt(0) : "R"}</div>
                    <div class="review-content">
                        <div class="review-header">
                            <div class="reviewer-name">${review.reviewer_name || "Anonymous Reviewer"}</div>
                            <div class="review-date">${new Date(review.created_at).toLocaleDateString()}</div>
                        </div>
                        <div class="review-rating">
                            ${"★".repeat(review.rating || 0)}${"☆".repeat(5 - (review.rating || 0))}
                        </div>
                        <div class="review-comment">
                            ${review.comments || "No comment provided"}
                        </div>
                        <div style="margin-top: 10px;">
                            <small style="color: var(--gray-500);">Book: ${review.book_title}</small>
                        </div>
                    </div>
                </div>
            `,
          )
          .join("");
      }

      // View book details
      async function viewBookDetails(bookId) {
        showLoading("Loading book details...");

        try {
          const response = await fetch(
            `${API_BASE_URL}/author/books/${bookId}`,
            {
              headers: {
                Authorization: `Bearer ${authToken}`,
              },
            },
          );

          const data = await response.json();

          if (data.success) {
            showBookDetailsModal(data.data);
          }
        } catch (error) {
          console.error("Failed to load book details:", error);
        } finally {
          hideLoading();
        }
      }

      // Show book details modal
      function showBookDetailsModal(data) {
        const book = data.book;

        document.getElementById("modalBookTitle").textContent = book.title;

        const content = `
                <div style="margin-bottom: 30px;">
                    <h4 style="margin-bottom: 10px; color: var(--gray-700);">Book Information</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div>
                            <strong>Status:</strong>
                            <span class="book-status status-${book.status}" style="margin-left: 10px;">${book.status.replace("_", " ")}</span>
                        </div>
                        <div><strong>Format:</strong> ${book.format}</div>
                        <div><strong>Category:</strong> ${book.category || "N/A"}</div>
                        <div><strong>ISBN:</strong> ${book.isbn || "Pending"}</div>
                        <div><strong>Pages:</strong> ${book.page_count || "N/A"}</div>
                        <div><strong>Language:</strong> ${book.language}</div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <strong>Description:</strong>
                        <p style="margin-top: 5px; color: var(--gray-600);">${book.description || "No description provided"}</p>
                    </div>
                </div>
                
                <div style="margin-bottom: 30px;">
                    <h4 style="margin-bottom: 15px; color: var(--gray-700);">Progress Tracking</h4>
                    <div class="progress-timeline">
                        ${data.progress
                          .map(
                            (stage, index) => `
                            <div class="timeline-item ${stage.status === "completed" ? "completed" : stage.status === "in_progress" ? "in-progress" : ""}">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-title">${stage.stage.replace("_", " ")}</div>
                                    <div class="timeline-date">
                                        ${stage.start_date ? `Started: ${new Date(stage.start_date).toLocaleDateString()}` : "Not started"}
                                        ${stage.completed_date ? ` | Completed: ${new Date(stage.completed_date).toLocaleDateString()}` : ""}
                                    </div>
                                    <div style="font-size: 14px; color: var(--gray-600); margin-top: 5px;">${stage.notes || "No notes"}</div>
                                </div>
                            </div>
                        `,
                          )
                          .join("")}
                    </div>
                </div>
                
                ${
                  data.reviews.length > 0
                    ? `
                    <div style="margin-bottom: 30px;">
                        <h4 style="margin-bottom: 15px; color: var(--gray-700);">Reviews (${data.reviews.length})</h4>
                        ${data.reviews
                          .map(
                            (review) => `
                            <div style="padding: 15px; background: var(--gray-100); border-radius: var(--border-radius); margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <strong>${review.reviewer_name || "Anonymous"}</strong>
                                    <span style="color: #ffc107;">${"★".repeat(review.rating || 0)}${"☆".repeat(5 - (review.rating || 0))}</span>
                                </div>
                                <p style="color: var(--gray-600); margin: 0;">${review.comments || "No comment"}</p>
                                <div style="font-size: 12px; color: var(--gray-500); margin-top: 5px;">
                                    ${new Date(review.created_at).toLocaleDateString()}
                                </div>
                            </div>
                        `,
                          )
                          .join("")}
                    </div>
                `
                    : ""
                }
                
                ${
                  data.royalties.length > 0
                    ? `
                    <div>
                        <h4 style="margin-bottom: 15px; color: var(--gray-700);">Royalty Statements</h4>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: var(--gray-100);">
                                        <th style="padding: 10px; text-align: left;">Period</th>
                                        <th style="padding: 10px; text-align: left;">Revenue</th>
                                        <th style="padding: 10px; text-align: left;">Royalty</th>
                                        <th style="padding: 10px; text-align: left;">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.royalties
                                      .map(
                                        (royalty) => `
                                        <tr style="border-bottom: 1px solid var(--gray-200);">
                                            <td style="padding: 10px;">${new Date(royalty.period_start).toLocaleDateString()} - ${new Date(royalty.period_end).toLocaleDateString()}</td>
                                            <td style="padding: 10px;">${formatCurrency(royalty.revenue)}</td>
                                            <td style="padding: 10px;">${formatCurrency(royalty.royalty_amount)}</td>
                                            <td style="padding: 10px;">
                                                <span style="display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 12px; 
                                                      background: ${royalty.payment_status === "paid" ? "#d4edda" : royalty.payment_status === "pending" ? "#fff3cd" : "#f8d7da"}; 
                                                      color: ${royalty.payment_status === "paid" ? "#155724" : royalty.payment_status === "pending" ? "#856404" : "#721c24"};">
                                                    ${royalty.payment_status}
                                                </span>
                                            </td>
                                        </tr>
                                    `,
                                      )
                                      .join("")}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `
                    : ""
                }
            `;

        document.getElementById("bookDetailsContent").innerHTML = content;
        document.getElementById("bookDetailsModal").classList.add("active");
      }

      // Show new book modal
      function showNewBookModal() {
        document.getElementById("newBookModal").classList.add("active");
      }

      // Submit new book
      document
        .getElementById("newBookForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const bookData = {
            title: document.getElementById("bookTitle").value,
            subtitle: document.getElementById("bookSubtitle").value,
            category: document.getElementById("bookCategory").value,
            description: document.getElementById("bookDescription").value,
            keywords: document.getElementById("bookKeywords").value,
            format: document.getElementById("bookFormat").value,
            status: "draft",
          };

          showLoading("Submitting book...");

          try {
            const response = await fetch(`${API_BASE_URL}/admin/books`, {
              method: "POST",
              headers: {
                Authorization: `Bearer ${authToken}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify(bookData),
            });

            const data = await response.json();

            if (data.success) {
              alert("Book submitted successfully!");
              closeModal("newBookModal");
              document.getElementById("newBookForm").reset();
              loadAuthorDashboard();
            } else {
              throw new Error(data.message || "Failed to submit book");
            }
          } catch (error) {
            alert("Failed to submit book: " + error.message);
          } finally {
            hideLoading();
          }
        });

      // Submit book for review
      async function submitBookForReview(bookId) {
        if (!confirm("Are you sure you want to submit this book for review?"))
          return;

        showLoading("Submitting for review...");

        try {
          const response = await fetch(
            `${API_BASE_URL}/admin/books/${bookId}/status`,
            {
              method: "PUT",
              headers: {
                Authorization: `Bearer ${authToken}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ status: "submitted" }),
            },
          );

          const data = await response.json();

          if (data.success) {
            alert("Book submitted for review successfully!");
            loadAuthorDashboard();
          }
        } catch (error) {
          alert("Failed to submit book for review: " + error.message);
        } finally {
          hideLoading();
        }
      }

      // Utility functions
      function formatCurrency(amount) {
        return new Intl.NumberFormat("en-NG", {
          style: "currency",
          currency: "NGN",
        }).format(amount);
      }

      function showLoading(text) {
        document.getElementById("loadingText").textContent = text;
        document.getElementById("loadingModal").classList.add("active");
      }

      function hideLoading() {
        document.getElementById("loadingModal").classList.remove("active");
      }

      function closeModal(modalId) {
        document.getElementById(modalId).classList.remove("active");
      }

      // Global functions
      window.closeModal = closeModal;
      window.viewBookDetails = viewBookDetails;
      window.showNewBookModal = showNewBookModal;
      window.submitBookForReview = submitBookForReview;
    </script>
  </body>
</html>
